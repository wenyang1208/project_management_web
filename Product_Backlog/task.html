<!DOCTYPE html>
<html>
<head>
  <title>Task</title>
  <link rel="stylesheet" href="task.css">
</head>
<body>

  <div class="white-frame">
      <div class="previous-page">
        <a href = "prodBacklog.html"><img src="previouspage.png" width=30px height = 30px></a>
      </div>
      <div class="menu-bar">
        <button id="menu-button"><img src="menubar.png" width=30px height=20px></button>
        <div class="menu-items" id="menu-items">
          <a href="prodBacklog.html">Product backlog</a>
          <a href="#">Scrumboard</a>
          <a href="#">Team management</a>
          <a href="#">Profile</a>
          <a href="#">Reset password</a>
          <a href="#">Log out</a>
        </div>
      </div>

    <div class="task-frame flex col">
      <!-- <div class="taskName"></div> -->
      <h1 id="taskNameHeader"></h1>

      <div class="taskview">
        <div class="flex col">
          <!-- <div class="assignee">
            <span class="text">Assignee: </span>
            <span class="text" id="Assignee">...</span>
          </div> -->
          <div class="task-info">
            <span class="info-label">Assignee:</span>
            <span class="info-value" id="asignees"></span>
          </div>

          <div class="priority">
            <span class="text">Priority: </span>
            <span class="text" id="taskPriority"></span>
          </div>

          <!-- <div class="stage-of-task">
            <span class="text">Stage of task: </span>
            <span class="text" id="stages">...</span>
          </div> -->
          <div class="task-info">
            <span class="info-label">Stage of task:</span>
            <span class="text" id="stages"></span>
        </div>

          <!-- Remap description here
          <div class="task-description">
            <div class="text">Task description:</div>
            <div class="description" id="task-description"></div>
          </div>-->

        </div>

        <div class="flex col">
          <div class="story-points">
            <span class="text">Story Points: </span>
            <span class="text" id="storyPoints"></span>
          </div>

          <div class="status">
            <span class="text">Status: </span>
            <span class="text" id="status">...</span>
          </div>
          <div class="category">
            <span class="text">Category: </span>
            <span class="text" id="category">...</span>
          </div>

        </div>

          <div class="tags-container">
            <div class="tags tags1" id="FE">Frontend</div>
            <div class="tags tags2" id="BE">Backend</div>
            <div class="tags tags3" id="API">API</div>
            <div class="tags tags4" id="DB">Database</div>
            <div class="tags tags5" id="FW">Framework</div>
            <div class="tags tags6" id="TEST">Testing</div>
            <div class="tags tags7" id="UI">UI</div>
            <div class="tags tags8" id="UX">UX</div>
          </div>

      </div>

      
      <div class="task-description">
        <div class="text">Task description:</div>
        <div class="description" id="task-description">Requirements:

          User Registration:
          
          Users should be able to register for an account by providing a valid email address and a secure password.
          Implement client-side and server-side validation to ensure data integrity.
          Store user registration data securely in our database.
          User Login:
          
          Registered users should be able to log in with their email and password.
          Implement password hashing and salting for security.
          Create a session or token-based authentication system.
          Password Reset:
          
          Allow users to request a password reset via email if they forget their password.
          Generate secure password reset tokens and implement a reset password flow.
          Authentication Middleware:
          
          Implement authentication middleware to protect certain routes and resources.
          Unauthorized access attempts should be redirected to the login page or return a 401 status code.
          User Profile:
          
          Create a user profile page where users can view and edit their profile information.
          Implement user authentication checks to ensure users can only edit their own profiles.
          Security Measures:
          
          Implement security best practices to protect against common web vulnerabilities (e.g., Cross-Site Scripting, Cross-Site Request Forgery).
          Regularly review and update security libraries and dependencies</div>
      </div>
    </div>
      <div class="button-container">
        <div id="edit-button" class="edit-button">Edit</div>

      </div>

 
    <br>
    

  </div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, set, get, child, query, orderByChild } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
const firebaseConfig = {
    apiKey: "AIzaSyAk2H_8opCo31ebK1Ce_hZ5G36XNkydR1s",
    authDomain: "project-2782373696466964042.firebaseapp.com",
    databaseURL: "https://project-2782373696466964042-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "project-2782373696466964042",
    storageBucket: "project-2782373696466964042.appspot.com",
    messagingSenderId: "971400388443",
    appId: "1:971400388443:web:fc495758d4109f4a1f847e"
};

// taskdetails.js (for taskdetails.html)
const
FE = document.getElementById("FE"),
BE = document.getElementById("BE"),
API = document.getElementById("API"),
DB = document.getElementById("DB"),
FW = document.getElementById("FW"),
TEST = document.getElementById("TEST"),
UI = document.getElementById("UI"),
UX = document.getElementById("UX"),
tagDisplayList = [FE,BE,API,DB,FW,TEST,UI,UX],
category = document.getElementById('category'),
savedTasks = []
const taskNameElement = document.getElementById("taskNameHeader");
const taskDescriptionElement = document.getElementById("task-description");
const taskPriorityElement = document.getElementById("taskPriority");
const storyPointsElement = document.getElementById("storyPoints");
const taskAssigneeElement = document.getElementById("asignees");
const taskStageElement = document.getElementById("stages");
const taskStatusElement = document.getElementById("status");
const taskTagsElement = document.getElementById("tags");
const editbutton = document.getElementById("edit-button")
const saveTaskButton = document.getElementById("saveTaskButton");

//----------------------------------------------get task id------------------------------------------------------------------
const urlParams = new URLSearchParams(window.location.search);
const taskId = urlParams.get("taskId");
document.addEventListener("DOMContentLoaded", function () {

//----------------------------------------------get data------------------------------------------------------------------
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dataRef = ref(db, "productBacklog/" + taskId);
    var task = {}

    get(dataRef).then((snapshot) => {
        if (snapshot.exists()) {
            console.log(snapshot.val())
            task = snapshot.val()
            snapshot.forEach((childSnapshot) => {
                const childData = childSnapshot.val();
                savedTasks.push(childData)
            });
    }}
    )
    .then(()=> console.log(savedTasks))
    .then(()=> displayTaskDetails(task));

//----------------------------------------------display task detail------------------------------------------------------------------
function displayTaskDetails(savedTasks){
    if (taskId !== null && taskId.length >= 0) {
        const task = {
          "dateAdded": savedTasks["dateAdded"],
            "taskAssignee": savedTasks["taskAssignee"],
            "taskCategory": savedTasks["taskCategory"],
            "taskDescription": savedTasks["taskDescription"],
            "taskName": savedTasks["taskName"],
            "taskPriority": savedTasks["taskPriority"],
            "taskStage": savedTasks["taskStage"],
            "taskStatus": savedTasks["taskStatus"],
            "taskStoryPoints": savedTasks["taskStoryPoints"],
            "taskTags": savedTasks["taskTags"]
        } 
        taskNameElement.textContent = task["taskName"];
        taskDescriptionElement.textContent = task["taskDescription"];
        taskPriorityElement.textContent = task["taskPriority"];
        storyPointsElement.textContent = task["taskStoryPoints"];
        taskStageElement.textContent = task["taskStage"];
        taskAssigneeElement.textContent = task["taskAssignee"];
        taskStatusElement.textContent = task["taskStatus"];
        category.textContent = task["taskCategory"];
        try{
            task["taskTags"].forEach((taskTag)=>{
                if (taskTag == null){
                  return;
                }
                else {
                    for (const tag of tagDisplayList){
                        if (taskTag == tag.textContent){
                            console.log(tag.textContent)
                            tag.style.display = "block";
                            break;
                        }
                    }
                }
              })
        }catch{console.log("Empty")}
    } else {
        taskNameElement.textContent = "Task not found.";
    }
}

//----------------------------------------------edit button------------------------------------------------------------------

    editbutton.addEventListener("click",function(event){
        event.preventDefault()
        window.location.href=`edittask.html?taskId=${taskId}`
    })
});
</script>
</body>
</html>